i = 0.1
field_id = 3063
result <- readRDS(paste0("binormal_field=",field_id,"_nmissing=",i,".rds"))
setwd("/Users/jianhuigao/Library/CloudStorage/OneDrive-UniversityofToronto/EHR_research/SyntheticSurrogateAnalysis/Data")
result <- readRDS(paste0("binormal_field=",field_id,"_nmissing=",i,".rds"))
results %>% ggplot(aes(x=beta_g_bi, y = beta_g_obs)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
xlim(-0.1, 0.1) +
ylim(-0.1, 0.1) +
labs(x = expression(beta[bivariate]), y = expression(beta[observed])) +
ggtitle(paste0("Missing rate = ", j))
library(ggplot2)
library(dplyr)
field_id = 3063
for(i in 1:4){
j = c(0.1, 0.25, 0.5, 0.75)[i]
result <- readRDS(paste0("binormal_field=",field_id,"_nmissing=",i,".rds"))
p1 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_obs)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
xlim(-0.1, 0.1) +
ylim(-0.1, 0.1) +
labs(x = expression(beta[bivariate]), y = expression(beta[observed])) +
ggtitle(paste0("Missing rate = ", j))
p2 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_surrogate)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
xlim(-0.1, 0.1) +
ylim(-0.1, 0.1)+
labs(x = expression(beta[bivariate]), y = expression(beta[predicted])) +
ggtitle(paste0("Missing rate = ",j))
png(paste0("beta_comparision_missing",j,".png"))
ggpubr::ggarrange(p1,p2)
dev.off()
}
min(c(x,y))
x <- result$beta_g_bi
y <- result$beta_g_obs
min(c(x,y))
max(c(x,y))
field_id = 3063
for(i in 1:4){
j = c(0.1, 0.25, 0.5, 0.75)[i]
result <- readRDS(paste0("binormal_field=",field_id,"_nmissing=",j,".rds"))
p1 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_obs)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[observed])) +
ggtitle(paste0("Missing rate = ", j))
p2 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_surrogate)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[predicted])) +
ggtitle(paste0("Missing rate = ",j))
png(paste0("beta_comparision_missing",j,".png"))
ggpubr::ggarrange(p1,p2)
dev.off()
}
field_id = 3063
for(i in 1:4){
j = c(0.1, 0.25, 0.5, 0.75)[i]
results <- readRDS(paste0("binormal_field=",field_id,"_nmissing=",j,".rds"))
p1 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_obs)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[observed])) +
ggtitle(paste0("Missing rate = ", j))
p2 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_surrogate)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[predicted])) +
ggtitle(paste0("Missing rate = ",j))
png(paste0("beta_comparision_missing",j,".png"))
ggpubr::ggarrange(p1,p2)
dev.off()
}
getwd()
results <- readRDS(paste0("binormal_field=",field_id,"_nmissing=",j,".rds"))
p1 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_obs)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[observed])) +
ggtitle(paste0("Missing rate = ", j))
p2 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_surrogate)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[predicted])) +
ggtitle(paste0("Missing rate = ",j))
ggpubr::ggarrange(p1,p2)
field_id = 3063
for(i in 1:4){
j = c(0.1, 0.25, 0.5, 0.75)[i]
results <- readRDS(paste0("binormal_field=",field_id,"_nmissing=",j,".rds"))
p1 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_obs)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[observed])) +
ggtitle(paste0("Missing rate = ", j))
p2 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_surrogate)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[predicted])) +
ggtitle(paste0("Missing rate = ",j))
png(paste0("beta_comparision_missing",j,".png"))
ggpubr::ggarrange(p1,p2)
dev.off()
}
getwd()
i = 1
j = c(0.1, 0.25, 0.5, 0.75)[i]
results <- readRDS(paste0("binormal_field=",field_id,"_nmissing=",j,".rds"))
p1 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_obs)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[observed])) +
ggtitle(paste0("Missing rate = ", j))
p2 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_surrogate)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[predicted])) +
ggtitle(paste0("Missing rate = ",j))
png(paste0("beta_comparision_missing",j,".png"))
ggpubr::ggarrange(p1,p2)
dev.off()
i = 2
j = c(0.1, 0.25, 0.5, 0.75)[i]
results <- readRDS(paste0("binormal_field=",field_id,"_nmissing=",j,".rds"))
p1 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_obs)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[observed])) +
ggtitle(paste0("Missing rate = ", j))
p2 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_surrogate)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[predicted])) +
ggtitle(paste0("Missing rate = ",j))
png(paste0("beta_comparision_missing",j,".png"))
ggpubr::ggarrange(p1,p2)
dev.off()
i = 3
j = c(0.1, 0.25, 0.5, 0.75)[i]
results <- readRDS(paste0("binormal_field=",field_id,"_nmissing=",j,".rds"))
p1 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_obs)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[observed])) +
ggtitle(paste0("Missing rate = ", j))
p2 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_surrogate)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[predicted])) +
ggtitle(paste0("Missing rate = ",j))
png(paste0("beta_comparision_missing",j,".png"))
ggpubr::ggarrange(p1,p2)
dev.off()
i = 4
j = c(0.1, 0.25, 0.5, 0.75)[i]
results <- readRDS(paste0("binormal_field=",field_id,"_nmissing=",j,".rds"))
p1 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_obs)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[observed])) +
ggtitle(paste0("Missing rate = ", j))
p2 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_surrogate)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[predicted])) +
ggtitle(paste0("Missing rate = ",j))
png(paste0("beta_comparision_missing",j,".png"))
ggpubr::ggarrange(p1,p2)
dev.off()
for(i in 1:4){
j = c(0.1, 0.25, 0.5, 0.75)[i]
results <- readRDS(paste0("binormal_field=",field_id,"_nmissing=",j,".rds"))
p1 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_obs)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[observed])) +
ggtitle(paste0("Missing rate = ", j))
p2 <- results %>% ggplot(aes(x=beta_g_bi, y = beta_g_surrogate)) +
scattermore::geom_scattermore() +
geom_abline(slope = 1, col = 'red') +
labs(x = expression(beta[bivariate]), y = expression(beta[predicted])) +
ggtitle(paste0("Missing rate = ",j))
ggsave(file = paste0("beta_comparision_missing",j,".png"),
plot = ggpubr::ggarrange(p1,p2))
}
setwd(paste0("/Users/jianhuigao/Library/CloudStorage/OneDrive-UniversityofToronto/EHR_research/SyntheticSurrogateAnalysis/Result/", phenotype))
phenotype = "FEV1"
setwd(paste0("/Users/jianhuigao/Library/CloudStorage/OneDrive-UniversityofToronto/EHR_research/SyntheticSurrogateAnalysis/Result/", phenotype))
data_path <- "/Users/jianhuigao/Library/CloudStorage/OneDrive-UniversityofToronto/EHR_research/SyntheticSurrogateAnalysis/Data/"
result_path <- paste0("/Users/jianhuigao/Library/CloudStorage/OneDrive-UniversityofToronto/EHR_research/SyntheticSurrogateAnalysis/Result/", phenotype,"/")
longdata <- data.frame()
for(i in 1:4){
j = c(0.1, 0.25, 0.5, 0.75)[i]
results <- readRDS(paste0(data_path,"binormal_field=",field_id,"_nmissing=",j,".rds"))
longdata <- rbind(longdata,cbind((results$se_obs/results$se_bi)^2,rep("bivariate/observed", nrow(results)), rep(j, nrow(results))))
longdata <- rbind(longdata,cbind((results$se_surrogate/results$se_bi)^2,rep("bivariate/surrogate", nrow(results)), rep(j, nrow(results))))
}
longdata <- data.frame(longdata)
longdata$V1 <- as.numeric(longdata$V1)
longdata %>% ggplot() + geom_boxplot(aes(y= V1, color = V2, x = factor(V3))) + labs(y = "RE", x = "Percent of missing", color = "Ratio")
View(longdata)
longdata %>% ggplot() + geom_boxplot(aes(y= V1, color = V2, x = factor(V3))) + labs(y = "RE", x = "Percent of missing", color = "Ratio") + xlim(c(0,1.2))
longdata %>% ggplot() + geom_boxplot(aes(y= V1, color = V2, x = factor(V3))) + labs(y = "RE", x = "Percent of missing", color = "Ratio") + ylim(c(0,1.2))
ggsave(filename = paste0(result_path, "relative_efficiency.png"))
source("~/Library/CloudStorage/OneDrive-UniversityofToronto/EHR_research/SyntheticSurrogateAnalysis/Code/SynSurrogateSim.R")
source("~/Library/CloudStorage/OneDrive-UniversityofToronto/EHR_research/SyntheticSurrogateAnalysis/Code/SynSurrogateSim.R")
pheno <- GenPheno(n = 10^3, beta = c(1,2))
G <- GenGeno(n = 10^3, snps = 1)
assoc.oracle <- lm(oracle ~ ., data = data.frame(
cbind(pheno %>% select(oracle, starts_with("x")), g)
))
g <- GenGeno(n = 10^3, snps = 1)
assoc.oracle <- lm(oracle ~ ., data = data.frame(
cbind(pheno %>% select(oracle, starts_with("x")), g)
))
summary(assoc.oracle)$coefficients["g", 1:2]
summary(assoc.oracle)$coefficients["g", 1:3]
summary(assoc.oracle)$coefficients["g", 1:4]
summary(assoc.oracle)$coefficients["g"]
summary(assoc.oracle)$coefficients["g",]
out <- summary(assoc.oracle)$coefficients["g"]
assoc.observed <- lm(target ~ ., data = data.frame(
cbind(pheno %>% select(target, starts_with("x")), g)
))
pheno <- GenPheno(n = 10^3, beta = c(1,2))
g <- GenGeno(n = 10^3, snps = 1)
assoc.oracle <- lm(oracle ~ ., data = data.frame(
cbind(pheno %>% select(oracle, starts_with("x")), g)
))
out <- summary(assoc.oracle)$coefficients["g",]
assoc.observed <- lm(target ~ ., data = data.frame(
cbind(pheno %>% select(target, starts_with("x")), g)
))
out <- c(out, summary(assoc.observed)$coefficients["g",]
)
assoc.surrogate <- lm(surrogate ~ ., data = data.frame(
cbind(pheno %>% select(surrogate, starts_with("x")), g)
))
out <- c(out, summary(assoc.surrogate)$coefficients["g",])
out
GenPheno(n = 10, beta = c(1,2), intercept = TRUE)
GenPheno(n = 10, beta = c(1,2), include_intercept = T)
pheno <- GenPheno(n = 10^3, beta = c(1,2))
g <- GenGeno(n = 10^3, snps = 1)
assoc.oracle <- lm(oracle ~ . -1, data = data.frame(
cbind(pheno %>% select(oracle, starts_with("x")), g)
))
out <- summary(assoc.oracle)$coefficients["g",]
assoc.observed <- lm(target ~ . -1, data = data.frame(
cbind(pheno %>% select(target, starts_with("x")), g)
))
out <- c(out, summary(assoc.observed)$coefficients["g",])
assoc.surrogate <- lm(surrogate ~ . -1, data = data.frame(
cbind(pheno %>% select(surrogate, starts_with("x")), g)
))
out <- c(out, summary(assoc.surrogate)$coefficients["g",])
out
starts_with("x")
pheno %>% starts_with(x)
fit.binormal <- SurrogateRegression::Fit.BNLS(
t = pheno$target,
s = pheno$surrogate,
X = pheno %>% select(starts_with("x"))
)
devtools::install_github(repo = 'zrmacc/SurrogateRegression')
devtools::install_github(repo = 'zrmacc/SurrogateRegression')
vas <- c("oracle", "target", "surrogate", "bi")
vis <- c("beta", "se", "p")
outer(vas, vis, paste, sep=".")
as.vector(outer(vas, vis, paste, sep="."))
?as.vector
as.vector(t(outer(vas, vis, paste, sep=".")))
library(doParallel)
missing_rate <- c(0, 0.25, 0.5, 0.75)
View(GenPheno)
saveRDS(result, file = "t1e.rds")
