---
title: "SimResult"
author: "Jianhui Gao"
date: "7/1/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache=TRUE)
source("~/Documents/GitHub/SyntheticSurrogateAnalysis/Code/imputation_simulation.R")
```

# Simulation Parameter

- sample size n = 1000
- number of replicates = 1000
- $Y = G -0.5 X + 0.5 Z + \epsilon$, where $G \sim Bin(2, maf = 0.25), \begin{bmatrix} X \\ Z  \end{bmatrix} \sim N \Big(\begin{bmatrix} 0 \\ 0  \end{bmatrix}, \begin{bmatrix} 1 & \rho \\ \rho & 1  \end{bmatrix}\Big), \epsilon \sim N(0, 1).$
- Missing rate of $Y$ is 20%.


# Single Imputation

## Beta known, model correctly specified
```{r}
set.seed(101)
sim <- Sim(reps = 1e3, beta = c(1, -0.5, 0.5), cov = c("g","x","z"),single = TRUE)

# Boxplots.
q <- PlotSim(sim, single = TRUE)
show(q)

# Tabulate results.
tab <- TabulateSim(sim)
tab$estimator <- c("si", "obs", "oracle")
show(tab)

# Compare empirical standard error to estimated standard error.
se_comp <- rbind(
  apply(sim[, c(1, 3, 5)], 2, sd),
  apply(sim[, c(2, 4, 6)], 2, mean)
)
colnames(se_comp) <- c("oracle", "observed", "single imputation")
rownames(se_comp) <- c("empirical", "estimated")
print(se_comp)
```

## Beta known, model incorrectly specified

$\hat{Y} \sim G, X$

```{r}
set.seed(101)
sim <- Sim(reps = 1e3, beta = c(1, -0.5), cov = c("g","x"),single = TRUE)

# Boxplots.
q <- PlotSim(sim, single = TRUE)
show(q)

# Tabulate results.
tab <- TabulateSim(sim)
tab$estimator <- c("si", "obs", "oracle")
show(tab)

# Compare empirical standard error to estimated standard error.
se_comp <- rbind(
  apply(sim[, c(1, 3, 5)], 2, sd),
  apply(sim[, c(2, 4, 6)], 2, mean)
)
colnames(se_comp) <- c("oracle", "observed", "single imputation")
rownames(se_comp) <- c("empirical", "estimated")
print(se_comp)
```

$\hat{Y} \sim X, Z$

```{r}
set.seed(101)
sim <- Sim(reps = 1e3, beta = c(-0.5, 0.5), cov = c("x", "z"),single = TRUE)

# Boxplots.
q <- PlotSim(sim, single = TRUE)
show(q)

# Tabulate results.
tab <- TabulateSim(sim)
tab$estimator <- c("si", "obs", "oracle")
show(tab)

# Compare empirical standard error to estimated standard error.
se_comp <- rbind(
  apply(sim[, c(1, 3, 5)], 2, sd),
  apply(sim[, c(2, 4, 6)], 2, mean)
)
colnames(se_comp) <- c("oracle", "observed", "single imputation")
rownames(se_comp) <- c("empirical", "estimated")
print(se_comp)
```

# Beta unkown and correctly specified

```{r}
set.seed(101)
sim <- Sim(reps = 1e3, beta = NULL, cov = c("g","x", "z"),single = TRUE)

# Boxplots.
q <- PlotSim(sim, single = TRUE)
show(q)

# Tabulate results.
tab <- TabulateSim(sim)
tab$estimator <- c("si", "obs", "oracle")
show(tab)

# Compare empirical standard error to estimated standard error.
se_comp <- rbind(
  apply(sim[, c(1, 3, 5)], 2, sd),
  apply(sim[, c(2, 4, 6)], 2, mean)
)
colnames(se_comp) <- c("oracle", "observed", "single imputation")
rownames(se_comp) <- c("empirical", "estimated")
print(se_comp)
```

# Beta unkown and incorrectly specified

$\hat{Y} \sim G, X$

```{r}
set.seed(101)
sim <- Sim(reps = 1e3, beta = NULL, cov = c("g","x"), single = TRUE)

# Boxplots.
q <- PlotSim(sim, single = TRUE)
show(q)

# Tabulate results.
tab <- TabulateSim(sim)
tab$estimator <- c("si", "obs", "oracle")
show(tab)

# Compare empirical standard error to estimated standard error.
se_comp <- rbind(
  apply(sim[, c(1, 3, 5)], 2, sd),
  apply(sim[, c(2, 4, 6)], 2, mean)
)
colnames(se_comp) <- c("oracle", "observed", "single imputation")
rownames(se_comp) <- c("empirical", "estimated")
print(se_comp)
```

$\hat{Y} \sim X, Z$

```{r}
set.seed(101)
sim <- Sim(reps = 1e3, beta = NULL, cov = c("x", "z"), single = TRUE)

# Boxplots.
q <- PlotSim(sim, single = TRUE)
show(q)

# Tabulate results.
tab <- TabulateSim(sim)
tab$estimator <- c("si", "obs", "oracle")
show(tab)

# Compare empirical standard error to estimated standard error.
se_comp <- rbind(
  apply(sim[, c(1, 3, 5)], 2, sd),
  apply(sim[, c(2, 4, 6)], 2, mean)
)
colnames(se_comp) <- c("oracle", "observed", "single imputation")
rownames(se_comp) <- c("empirical", "estimated")
print(se_comp)
```

# Multiple Imputation 
## Beta known, model correctly specified
```{r}
set.seed(101)
sim <- Sim(reps = 1e3, beta = c(1, -0.5, 0.5), cov = c("g","x","z"),single = FALSE)

# Boxplots.
q <- PlotSim(sim, single = FALSE)
show(q)

# Tabulate results.
tab <- TabulateSim(sim)
show(tab)

# Compare empirical standard error to estimated standard error.
se_comp <- rbind(
  apply(sim[, c(1, 3, 5)], 2, sd),
  apply(sim[, c(2, 4, 6)], 2, mean)
)
rownames(se_comp) <- c("empirical", "estimated")
print(se_comp)
```

## Beta known, model incorrectly specified

$\hat{Y} \sim G + X$

```{r}
set.seed(101)
sim <- Sim(reps = 1e3, beta = c(1, -0.5), cov = c("g","x"),single = FALSE)

# Boxplots.
q <- PlotSim(sim, single = FALSE)
show(q)

# Tabulate results.
tab <- TabulateSim(sim)
show(tab)

# Compare empirical standard error to estimated standard error.
se_comp <- rbind(
  apply(sim[, c(1, 3, 5)], 2, sd),
  apply(sim[, c(2, 4, 6)], 2, mean)
)
rownames(se_comp) <- c("empirical", "estimated")
print(se_comp)
```

$\hat{Y} \sim X + Z$

```{r}
set.seed(101)
sim <- Sim(reps = 1e3, beta = c(-0.5, 0.5), cov = c("x","z"),single = FALSE)

# Boxplots.
q <- PlotSim(sim, single = FALSE)
show(q)

# Tabulate results.
tab <- TabulateSim(sim)
show(tab)

# Compare empirical standard error to estimated standard error.
se_comp <- rbind(
  apply(sim[, c(1, 3, 5)], 2, sd),
  apply(sim[, c(2, 4, 6)], 2, mean)
)
rownames(se_comp) <- c("empirical", "estimated")
print(se_comp)
```

## Beta unknown, model correctly specified
```{r}
set.seed(101)
sim <- Sim(reps = 1e3, beta = NULL, cov = c("g","x", "z"),single = FALSE)

# Boxplots.
q <- PlotSim(sim, single = FALSE)
show(q)

# Tabulate results.
tab <- TabulateSim(sim)
show(tab)

# Compare empirical standard error to estimated standard error.
se_comp <- rbind(
  apply(sim[, c(1, 3, 5)], 2, sd),
  apply(sim[, c(2, 4, 6)], 2, mean)
)
rownames(se_comp) <- c("empirical", "estimated")
print(se_comp)
```

## Beta unknown, model incorrectly specified

$\hat{Y} \sim G + X$
```{r}
set.seed(101)
sim <- Sim(reps = 1e3, beta = NULL, cov = c("g","x"),single = FALSE)

# Boxplots.
q <- PlotSim(sim, single = FALSE)
show(q)

# Tabulate results.
tab <- TabulateSim(sim)
show(tab)

# Compare empirical standard error to estimated standard error.
se_comp <- rbind(
  apply(sim[, c(1, 3, 5)], 2, sd),
  apply(sim[, c(2, 4, 6)], 2, mean)
)
rownames(se_comp) <- c("empirical", "estimated")
print(se_comp)
```

$\hat{Y} \sim X + Z$
```{r}
set.seed(101)
sim <- Sim(reps = 1e3, beta = NULL, cov = c("x","z"),single = FALSE)

# Boxplots.
q <- PlotSim(sim, single = FALSE)
show(q)

# Tabulate results.
tab <- TabulateSim(sim)
show(tab)

# Compare empirical standard error to estimated standard error.
se_comp <- rbind(
  apply(sim[, c(1, 3, 5)], 2, sd),
  apply(sim[, c(2, 4, 6)], 2, mean)
)
rownames(se_comp) <- c("empirical", "estimated")
print(se_comp)
```
